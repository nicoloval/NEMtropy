

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>NEMtropy.graph_classes &mdash; NEMtropy 1.0.5 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> NEMtropy
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">How to install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NEMtropy.html">Classes and Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">GNU GENERAL PUBLIC LICENSE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contacts.html">Contacts</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">NEMtropy</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>NEMtropy.graph_classes</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for NEMtropy.graph_classes</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">models_functions</span> <span class="k">as</span> <span class="n">mof</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">solver_functions</span> <span class="k">as</span> <span class="n">sof</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">network_functions</span> <span class="k">as</span> <span class="n">nef</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ensemble_generator</span> <span class="k">as</span> <span class="n">eg</span>
<span class="c1"># Stops Numba Warning for experimental feature</span>
<span class="kn">from</span> <span class="nn">numba.core.errors</span> <span class="kn">import</span> <span class="n">NumbaExperimentalFeatureWarning</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span>
    <span class="n">action</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span>
    <span class="n">category</span><span class="o">=</span><span class="n">NumbaExperimentalFeatureWarning</span><span class="p">)</span>


<div class="viewcode-block" id="UndirectedGraph"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.UndirectedGraph">[docs]</a><span class="k">class</span> <span class="nc">UndirectedGraph</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Undirected Graph instance can be initialised with adjacency</span>
<span class="sd">    matrix, edgelist, degrees sequence or strengths sequence.</span>

<span class="sd">    :param adjacency: Adjacency matrix, defaults to None.</span>
<span class="sd">    :type adjacency: numpy.ndarray, list or scipy.sparse_matrix, optional</span>
<span class="sd">    :param edgelist: edgelist, defaults to None.</span>
<span class="sd">    :type edgelist: numpy.ndarray, list, optional</span>
<span class="sd">    :param degree_sequence: degrees sequence, defaults to None.</span>
<span class="sd">    :type degree_sequence: numpy.ndarray, optional</span>
<span class="sd">    :param strength_sequence: strengths sequence, defaults to None.</span>
<span class="sd">    :type strength_sequence: numpy.ndarray, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">adjacency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">edgelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">degree_sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">strength_sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgelist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_randomized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_weighted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_graph</span><span class="p">(</span>
            <span class="n">adjacency</span><span class="o">=</span><span class="n">adjacency</span><span class="p">,</span>
            <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span>
            <span class="n">degree_sequence</span><span class="o">=</span><span class="n">degree_sequence</span><span class="p">,</span>
            <span class="n">strength_sequence</span><span class="o">=</span><span class="n">strength_sequence</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">avg_mat</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Reduced problem parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_reduced</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_n</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_dim</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_multiplicity</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Problem solutions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># reduced solutions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Problem (reduced) residuals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_beta</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nz_index</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnz_n</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_degree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_strength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_strength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_initialize_graph</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">adjacency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">edgelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">degree_sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">strength_sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="c1"># Here we can put controls over the type of input. For instance, if the graph is directed,</span>
        <span class="c1"># i.e. adjacency matrix is asymmetric, the class to use must be the DiGraph,</span>
        <span class="c1"># or if the graph is weighted (edgelist contains triplets or matrix is not binary) or bipartite</span>

        <span class="k">if</span> <span class="n">adjacency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">adjacency</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">isspmatrix</span><span class="p">(</span><span class="n">adjacency</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;The adjacency matrix must be passed as a list or&quot;</span>
                    <span class="s2">&quot;numpy array or scipy sparse matrix.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">adjacency</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adjacency</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;The adjacency matrix entries must be positive.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">adjacency</span><span class="p">,</span> <span class="nb">list</span>
                <span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span> <span class="o">=</span> <span class="n">adjacency</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span> <span class="o">=</span> <span class="n">adjacency</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adjacency</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">degree</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">strength</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nz_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_weighted</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">edgelist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edgelist</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;The edgelist must be passed as a list or numpy array.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgelist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgelist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;This is not an edgelist. An edgelist must be a list&quot;</span>
                        <span class="s2">&quot;or array of couples of nodes with optional weights.&quot;</span>
                        <span class="s2">&quot;Is this an adjacency matrix?&quot;</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgelist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">edgelist</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">edgelist_from_edgelist_undirected</span><span class="p">(</span><span class="n">edgelist</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">edgelist</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">edgelist_from_edgelist_undirected</span><span class="p">(</span><span class="n">edgelist</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">degree_sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;The degree sequence must be passed as a list or&quot;</span>
                    <span class="s2">&quot;numpy array.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;The degree sequence must contain numeric values.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A degree cannot be negative.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">=</span> <span class="n">degree_sequence</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">strength_sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="s2">&quot;The strength sequence must be passed as a&quot;</span>
                            <span class="s2">&quot;list or numpy array.&quot;</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="nb">int</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">except</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="s2">&quot;The strength sequence must contain numeric&quot;</span>
                                <span class="s2">&quot;values.&quot;</span>
                            <span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A strength cannot be negative.&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">):</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                    <span class="s2">&quot;Degrees and strengths arrays must have&quot;</span>
                                    <span class="s2">&quot;same length.&quot;</span>
                                <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">))</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">=</span> <span class="n">strength_sequence</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
                            <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">nz_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="p">)[</span>
                                <span class="mi">0</span>
                            <span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">is_weighted</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">strength_sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;The strength sequence must be passed as a list&quot;</span>
                    <span class="s2">&quot;or numpy array.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;The strength sequence must contain numeric values.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A strength cannot be negative.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">=</span> <span class="n">strength_sequence</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nz_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_weighted</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="UndirectedGraph.set_adjacency_matrix"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.UndirectedGraph.set_adjacency_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">set_adjacency_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adjacency</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialises graph given the adjacency matrix.</span>

<span class="sd">        :param adjacency: ajdacency matrix.</span>
<span class="sd">        :type adjacency: numpy.ndarray, list, scipy.sparse_matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Graph already contains edges or has a degree sequence.&quot;</span>
                <span class="s2">&quot;Use clean_edges() first.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_graph</span><span class="p">(</span><span class="n">adjacency</span><span class="o">=</span><span class="n">adjacency</span><span class="p">)</span></div>

<div class="viewcode-block" id="UndirectedGraph.set_edgelist"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.UndirectedGraph.set_edgelist">[docs]</a>    <span class="k">def</span> <span class="nf">set_edgelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialises graph given the edgelist.</span>

<span class="sd">        :param edgelist: edgelist.</span>
<span class="sd">        :type edgelist: numpy.ndarray, list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Graph already contains edges or has a degree sequence.&quot;</span>
                <span class="s2">&quot;Use clean_edges() first.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_graph</span><span class="p">(</span><span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">)</span></div>

<div class="viewcode-block" id="UndirectedGraph.set_degree_sequences"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.UndirectedGraph.set_degree_sequences">[docs]</a>    <span class="k">def</span> <span class="nf">set_degree_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree_sequence</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialises graph given the degrees sequence.</span>

<span class="sd">        :param degree_sequence: degrees sequence.</span>
<span class="sd">        :type degree_sequence: numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;Graph already contains edges or has a degree sequence.&quot;</span>
                <span class="s2">&quot;Use clean_edges() first.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_graph</span><span class="p">(</span><span class="n">degree_sequence</span><span class="o">=</span><span class="n">degree_sequence</span><span class="p">)</span></div>

<div class="viewcode-block" id="UndirectedGraph.clean_edges"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.UndirectedGraph.clean_edges">[docs]</a>    <span class="k">def</span> <span class="nf">clean_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes all the initialiased attributes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgelist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deg_seq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">_solve_problem</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_guess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;cm&quot;</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;quasinewton&quot;</span><span class="p">,</span>
        <span class="n">max_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">full_return</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">linsearch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">regularise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span> <span class="o">=</span> <span class="n">full_return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">=</span> <span class="n">initial_guess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regularise</span> <span class="o">=</span> <span class="n">regularise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_problem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_model</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span>

        <span class="n">sol</span> <span class="o">=</span> <span class="n">sof</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span>
            <span class="n">x0</span><span class="p">,</span>
            <span class="n">fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span>
            <span class="n">fun_jac</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun_jac</span><span class="p">,</span>
            <span class="n">step_fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step_fun</span><span class="p">,</span>
            <span class="n">linsearch_fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun_linsearch</span><span class="p">,</span>
            <span class="n">hessian_regulariser</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hessian_regulariser</span><span class="p">,</span>
            <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
            <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">regularise</span><span class="o">=</span><span class="n">regularise</span><span class="p">,</span>
            <span class="n">full_return</span><span class="o">=</span><span class="n">full_return</span><span class="p">,</span>
            <span class="n">linsearch</span><span class="o">=</span><span class="n">linsearch</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_solved_problem_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comput_time</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_steps</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alfa_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">solution</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">==</span> <span class="s2">&quot;cm&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">==</span> <span class="s2">&quot;cm_exp&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_set_solved_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">,</span> <span class="s2">&quot;cm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem_cm</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ecm&quot;</span><span class="p">,</span> <span class="s2">&quot;ecm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem_ecm</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema&quot;</span><span class="p">,</span> <span class="s2">&quot;crema-sparse&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem_crema_undirected</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

<div class="viewcode-block" id="UndirectedGraph.degree_reduction"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.UndirectedGraph.degree_reduction">[docs]</a>    <span class="k">def</span> <span class="nf">degree_reduction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Carries out degree reduction for UBCM.</span>
<span class="sd">        The graph should be initialized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_index_dseq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_multiplicity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">,</span>
            <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rnz_n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span><span class="o">.</span><span class="n">size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_reduced</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_set_initial_guess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">,</span> <span class="s2">&quot;cm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_guess_cm</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ecm&quot;</span><span class="p">,</span> <span class="s2">&quot;ecm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_guess_ecm</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema&quot;</span><span class="p">,</span> <span class="s2">&quot;crema-sparse&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_guess_crema_undirected</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set_initial_guess_cm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">is_reduced</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">degree_reduction</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r_index_dseq</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;degrees_minor&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>  <span class="c1"># This +1 increases the stability of the solutions.</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_n</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;uniform&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rnz_n</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
                <span class="p">)</span>  <span class="c1"># All probabilities will be 1/2 initially</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;degrees&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;chung_lu&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not an available initial guess&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;initial_guess must be str or numpy.ndarray&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">==</span> <span class="s2">&quot;cm&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">==</span> <span class="s2">&quot;cm_exp&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span>

    <span class="k">def</span> <span class="nf">_set_initial_guess_crema_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;strengths&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                    <span class="nb">float</span>
                <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;strengths_minor&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not an available initial guess&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;initial_guess must be str or numpy.ndarray&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span>

    <span class="k">def</span> <span class="nf">_set_initial_guess_ecm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;strengths&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>  <span class="c1"># This +1 increases the stability of the solutions.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                    <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;strengths_minor&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;uniform&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.001</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not an available initial guess&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;initial_guess must be str or numpy.ndarray&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">==</span> <span class="s2">&quot;ecm&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">==</span> <span class="s2">&quot;ecm_exp&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

    <span class="c1"># DA SISTEMARE</span>
    <span class="k">def</span> <span class="nf">_solution_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">,</span> <span class="s2">&quot;cm_exp&quot;</span><span class="p">,</span> <span class="s2">&quot;crema&quot;</span><span class="p">,</span> <span class="s2">&quot;crema-sparse&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ex_k</span> <span class="o">=</span> <span class="n">mof</span><span class="o">.</span><span class="n">expected_degree_cm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="c1"># print(k, ex_k)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expected_dseq</span> <span class="o">=</span> <span class="n">ex_k</span>
                <span class="c1"># error output</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ex_k</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">((</span><span class="n">ex_k</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">)),</span> <span class="nb">ord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span><span class="p">:</span>
                    <span class="n">ex_s</span> <span class="o">=</span> <span class="n">mof</span><span class="o">.</span><span class="n">expected_strength_crema_undirected_sparse</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ex_s</span> <span class="o">=</span> <span class="n">mof</span><span class="o">.</span><span class="n">expected_strength_crema_undirected</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expected_stregth_seq</span> <span class="o">=</span> <span class="n">ex_s</span>
                <span class="c1"># error output</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error_strength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                    <span class="n">ex_s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_strength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
                    <span class="nb">abs</span><span class="p">(</span>
                     <span class="p">(</span><span class="n">ex_s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">))</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_strength</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_strength</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span><span class="p">)</span>

        <span class="c1"># potremmo strutturarlo cos per evitare ridondanze</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ecm&quot;</span><span class="p">,</span> <span class="s2">&quot;ecm_exp&quot;</span><span class="p">]:</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
            <span class="n">ex</span> <span class="o">=</span> <span class="n">mof</span><span class="o">.</span><span class="n">expected_ecm</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expected_dseq</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expected_strength_seq</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>

            <span class="c1"># error output</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_dseq</span> <span class="o">-</span>
                                               <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_strength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_strength_seq</span> <span class="o">-</span>
                                                 <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="p">,</span>
                                                 <span class="nb">ord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_strength</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span> <span class="o">-</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">expected_strength_seq</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span>
                    <span class="p">)</span>
                <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_degree</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_dseq</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_strength</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema&quot;</span><span class="p">,</span> <span class="s2">&quot;crema-sparse&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nz_index</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">,</span> <span class="s2">&quot;cm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_multiplicity</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ecm&quot;</span><span class="p">,</span> <span class="s2">&quot;ecm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">strength_sequence</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initialize_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_guess</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_args</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="n">mod_met</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
        <span class="n">mod_met</span> <span class="o">=</span> <span class="n">mod_met</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">model</span><span class="p">,</span> <span class="n">method</span><span class="p">])</span>

        <span class="n">d_fun</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_cm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;cm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_cm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;cm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">iterative_cm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_crema_undirected</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_crema_undirected</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">iterative_crema_undirected</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;ecm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_ecm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;ecm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_ecm</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;ecm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">iterative_ecm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema-sparse-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_crema_undirected_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_crema_undirected_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">iterative_crema_undirected_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;cm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_cm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;cm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_cm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;cm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">iterative_cm_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;ecm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_ecm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;ecm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_ecm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;ecm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">iterative_ecm_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="n">d_fun_jac</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_cm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;cm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_cm</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;cm-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;crema-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_crema_undirected</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_crema_undirected</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;ecm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_ecm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;ecm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_ecm</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;ecm-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;crema-sparse-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_crema_undirected</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_crema_undirected_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;cm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_cm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;cm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_cm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;cm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;ecm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_ecm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;ecm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_ecm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;ecm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">d_fun_stop</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_cm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;cm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_cm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;cm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_cm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_undirected</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_undirected</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_undirected</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;ecm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_ecm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;ecm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_ecm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;ecm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_ecm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema-sparse-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_undirected_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_undirected_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_undirected_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;cm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_cm_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;cm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_cm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;cm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_cm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;ecm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_ecm_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;ecm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_ecm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;ecm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_ecm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
        <span class="p">}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">d_fun</span><span class="p">[</span><span class="n">mod_met</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fun_jac</span> <span class="o">=</span> <span class="n">d_fun_jac</span><span class="p">[</span><span class="n">mod_met</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_fun</span> <span class="o">=</span> <span class="n">d_fun_stop</span><span class="p">[</span><span class="n">mod_met</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Method must be &quot;newton&quot;,&quot;quasi-newton&quot;, or &quot;fixed-point&quot;.&#39;</span>
            <span class="p">)</span>

        <span class="n">d_pmatrix</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cm&quot;</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">pmatrix_cm</span><span class="p">,</span>
            <span class="s2">&quot;cm_exp&quot;</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">pmatrix_cm</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">,</span> <span class="s2">&quot;cm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args_p</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fun_pmatrix</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">d_pmatrix</span><span class="p">[</span><span class="n">model</span><span class="p">](</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_p</span><span class="p">)</span>

        <span class="n">args_lin</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_cm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_undirected</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema-sparse&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_undirected_sparse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;ecm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_ecm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;cm_exp&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_cm_exp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;ecm_exp&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_ecm_exp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span> <span class="o">=</span> <span class="n">args_lin</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>

        <span class="n">lins_fun</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_CM</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;cm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_CM</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;cm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_CM_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="s2">&quot;crema-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_undirected</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;crema-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_undirected</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;crema-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_undirected_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="s2">&quot;crema-sparse-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_undirected</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;crema-sparse-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_undirected</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;crema-sparse-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_undirected_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="s2">&quot;ecm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_ECM</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;ecm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_ECM</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;ecm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_ECM_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="s2">&quot;cm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_CM_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;cm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_CM_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;cm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_CM_exp_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="s2">&quot;ecm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_ECM_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;ecm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_ECM_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;ecm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_ECM_exp_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fun_linsearch</span> <span class="o">=</span> <span class="n">lins_fun</span><span class="p">[</span><span class="n">mod_met</span><span class="p">]</span>

        <span class="n">hess_reg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;cm&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function_eigen_based</span><span class="p">,</span>
            <span class="s2">&quot;cm_exp&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function</span><span class="p">,</span>
            <span class="s2">&quot;ecm&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function_eigen_based</span><span class="p">,</span>
            <span class="s2">&quot;ecm_exp&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function</span><span class="p">,</span>
            <span class="s2">&quot;crema&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function</span><span class="p">,</span>
            <span class="s2">&quot;crema-sparse&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hessian_regulariser</span> <span class="o">=</span> <span class="n">hess_reg</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularise</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularise</span> <span class="o">==</span> <span class="s2">&quot;eigenvalues&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hessian_regulariser</span> <span class="o">=</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function_eigen_based</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularise</span> <span class="o">==</span> <span class="s2">&quot;identity&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hessian_regulariser</span> <span class="o">=</span> <span class="n">hessian_regulariser_function</span>

    <span class="k">def</span> <span class="nf">_solve_problem_crema_undirected</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_guess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;crema&quot;</span><span class="p">,</span>
        <span class="n">adjacency</span><span class="o">=</span><span class="s2">&quot;cm&quot;</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;quasinewton&quot;</span><span class="p">,</span>
        <span class="n">method_adjacency</span><span class="o">=</span><span class="s2">&quot;newton&quot;</span><span class="p">,</span>
        <span class="n">initial_guess_adjacency</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
        <span class="n">max_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">full_return</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">linsearch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">regularise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;crema-sparse&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">isspmatrix</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;adjacency must be a matrix or a method&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>

            <span class="c1"># aggiungere check sul modello passato per l&#39;adjacency matrix</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_solve_problem</span><span class="p">(</span>
                <span class="n">initial_guess</span><span class="o">=</span><span class="n">initial_guess_adjacency</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">adjacency</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method_adjacency</span><span class="p">,</span>
                <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
                <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
                <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
                <span class="n">full_return</span><span class="o">=</span><span class="n">full_return</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="n">linsearch</span><span class="o">=</span><span class="n">linsearch</span><span class="p">,</span>
                <span class="n">regularise</span><span class="o">=</span><span class="n">regularise</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pmatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fun_pmatrix</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
                <span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">pmatrix</span><span class="p">))</span>
                <span class="n">raw_ind</span> <span class="o">=</span> <span class="n">raw_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="n">col_ind</span> <span class="o">=</span> <span class="n">col_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="n">weigths_value</span> <span class="o">=</span> <span class="n">pmatrix</span><span class="p">[</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">,</span> <span class="n">weigths_value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">adjacency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">adjacency</span><span class="p">))</span>
            <span class="n">raw_ind</span> <span class="o">=</span> <span class="n">raw_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">col_ind</span> <span class="o">=</span> <span class="n">col_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">weigths_value</span> <span class="o">=</span> <span class="n">adjacency</span><span class="p">[</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">,</span> <span class="n">weigths_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">adjacency</span> <span class="o">=</span> <span class="n">adjacency</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">adjacency</span><span class="p">))</span>
            <span class="n">raw_ind</span> <span class="o">=</span> <span class="n">raw_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">col_ind</span> <span class="o">=</span> <span class="n">col_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">weigths_value</span> <span class="o">=</span> <span class="n">adjacency</span><span class="p">[</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">,</span> <span class="n">weigths_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">isspmatrix</span><span class="p">(</span><span class="n">adjacency</span><span class="p">):</span>
            <span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
            <span class="n">raw_ind</span> <span class="o">=</span> <span class="n">raw_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">col_ind</span> <span class="o">=</span> <span class="n">col_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">weigths_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">adjacency</span><span class="p">[</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">]</span><span class="o">.</span><span class="n">A1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">,</span> <span class="n">weigths_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">=</span> <span class="s2">&quot;crema-sparse&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">=</span> <span class="n">model</span>
            <span class="n">linsearch</span> <span class="o">=</span> <span class="n">linsearch</span>
            <span class="n">regularise</span> <span class="o">=</span> <span class="n">regularise</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">regularise</span> <span class="o">=</span> <span class="n">regularise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span> <span class="o">=</span> <span class="n">full_return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">=</span> <span class="n">initial_guess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_problem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_model</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span>

        <span class="n">sol</span> <span class="o">=</span> <span class="n">sof</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span>
            <span class="n">x0</span><span class="p">,</span>
            <span class="n">fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span>
            <span class="n">fun_jac</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun_jac</span><span class="p">,</span>
            <span class="n">step_fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step_fun</span><span class="p">,</span>
            <span class="n">linsearch_fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun_linsearch</span><span class="p">,</span>
            <span class="n">hessian_regulariser</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hessian_regulariser</span><span class="p">,</span>
            <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
            <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">regularise</span><span class="o">=</span><span class="n">regularise</span><span class="p">,</span>
            <span class="n">linsearch</span><span class="o">=</span><span class="n">linsearch</span><span class="p">,</span>
            <span class="n">full_return</span><span class="o">=</span><span class="n">full_return</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_solved_problem_crema_undirected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comput_time_crema</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_steps_crema</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm_seq_crema</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff_seq_crema</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alfa_seq_crema</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="n">solution</span>

    <span class="k">def</span> <span class="nf">_set_solved_problem_ecm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comput_time</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_steps</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alfa_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">solution</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">==</span> <span class="s2">&quot;ecm&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">==</span> <span class="s2">&quot;ecm_exp&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:])</span>

<div class="viewcode-block" id="UndirectedGraph.solve_tool"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.UndirectedGraph.solve_tool">[docs]</a>    <span class="k">def</span> <span class="nf">solve_tool</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">method</span><span class="p">,</span>
        <span class="n">initial_guess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">adjacency</span><span class="o">=</span><span class="s2">&quot;cm_exp&quot;</span><span class="p">,</span>
        <span class="n">method_adjacency</span><span class="o">=</span><span class="s2">&quot;newton&quot;</span><span class="p">,</span>
        <span class="n">initial_guess_adjacency</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
        <span class="n">max_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">full_return</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">linsearch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The function solves the ERGM optimization problem from</span>
<span class="sd">        a range of available models. The user can choose among three</span>
<span class="sd">        optimization methods.</span>
<span class="sd">        The graph should be initialized.</span>

<span class="sd">        :param model: Available models are:</span>

<span class="sd">            - *cm*: solves UBCM respect to the parameters *x* of the mof.loglikelihood function, it works for uweighted undirected graphs [insert ref].</span>
<span class="sd">            - *cm_exp*: differently from the *cm* option, *cm_exp* considers the exponents of *x* as parameters [insert ref].</span>
<span class="sd">            - *ecm*: solves UECM respect to the parameters *x* and *y* of the mof.loglikelihood function, it is conceived for weighted undirected graphs [insert ref].</span>
<span class="sd">            - *ecm_exp*: differently from the *ecm* option, *ecm_exp* considers the exponents of *x* and *y* as parameters [insert ref].</span>
<span class="sd">            - *crema*: solves CReMa for a weighted undirectd graphs. In order to compute beta parameters, it requires information about the binary structure of the network. These can be provided by the user by using *adjacency* paramenter.</span>
<span class="sd">            - *crema-sparse*: alternative implementetio of *crema* for large graphs. The *creama-sparse* model doesn&#39;t compute the binary probability matrix avoing memory problems for large graphs.</span>

<span class="sd">        :type model: str</span>
<span class="sd">        :param method: Available methods to solve the given *model* are:</span>

<span class="sd">            - *newton*: uses Newton-Rhapson method to solve the selected model, it can be memory demanding for *crema* because it requires the computation of the entire Hessian matrix. This method is not available for *creama-sparse*.</span>
<span class="sd">            - *quasinewton*: uses Newton-Rhapson method with Hessian matrix approximated by its principal diagonal to find parameters maximising mof.loglikelihood function.</span>
<span class="sd">            - *fixed-point*: uses a fixed-point method to find parameters maximising mof.loglikelihood function.</span>

<span class="sd">        :type method: str</span>
<span class="sd">        :param initial_guess: Starting point solution may affect the results of the optization process. The user can provid an initial guess or choose between the following options:</span>

<span class="sd">            - **Binary Models**:</span>
<span class="sd">                - *random*: random numbers in (0, 1);</span>
<span class="sd">                - *uniform*: uniform initial guess in (0, 1);</span>
<span class="sd">                - *degrees*: initial guess of each node is proportianal to its degree;</span>
<span class="sd">                - *degrees_minor*: initial guess of each node is inversely proportional to its degree;</span>
<span class="sd">                - *chung_lu*: initial guess given by Chung-Lu formula;</span>
<span class="sd">            - **Weighted Models**:</span>
<span class="sd">                - *random*: random numbers in (0, 1);</span>
<span class="sd">                - *uniform*: uniform initial guess in (0, 1);</span>
<span class="sd">                - *strengths*: initial guess of each node is proportianal to its stength;</span>
<span class="sd">                - *strengths_minor*: initial guess of each node is inversely proportional to its strength;</span>
<span class="sd">        :type initial_guess: str, optional</span>
<span class="sd">        :param adjacency: Adjacency can be a binary method (defaults is *cm_exp*) or an adjacency matrix.</span>
<span class="sd">        :type adjacency: str or numpy.ndarray, optional</span>
<span class="sd">        :param method_adjacency: If adjacency is a *model*, it is the *methdod* used to solve it. Defaults to &quot;newton&quot;.</span>
<span class="sd">        :type method_adjacency: str, optional</span>
<span class="sd">        :param initial_guess_adjacency: If adjacency is a *model*, it is the chosen initial guess. Defaults to &quot;random&quot;.</span>
<span class="sd">        :type initial_guess_adjacency: str, optional</span>
<span class="sd">        :param max_steps: maximum number of iteration, defaults to 100.</span>
<span class="sd">        :type max_steps: int, optional</span>
<span class="sd">        :param full_return: If True the algorithm returns more statistics than the obtained solution, defaults to False.</span>
<span class="sd">        :type full_return: bool, optional</span>
<span class="sd">        :param verbose: If True the algorithm prints a bunch of statistics at each step, defaults to False.</span>
<span class="sd">        :type verbose: bool, optional</span>
<span class="sd">        :param linsearch: If True the linsearch function is active, defaults to True.</span>
<span class="sd">        :type linsearch: bool, optional</span>
<span class="sd">        :param tol: parameter controlling the tollerance of the norm the gradient function, defaults to 1e-8.</span>
<span class="sd">        :type tol: float, optional</span>
<span class="sd">        :param eps: parameter controlling the tollerance of the difference between two iterations, defaults to 1e-8.</span>
<span class="sd">        :type eps: float, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: aggiungere tutti i metodi</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">,</span> <span class="s2">&quot;cm_exp&quot;</span><span class="p">,</span> <span class="s2">&quot;ecm&quot;</span><span class="p">,</span> <span class="s2">&quot;ecm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_solve_problem</span><span class="p">(</span>
                <span class="n">initial_guess</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
                <span class="n">full_return</span><span class="o">=</span><span class="n">full_return</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="n">linsearch</span><span class="o">=</span><span class="n">linsearch</span><span class="p">,</span>
                <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
                <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema&quot;</span><span class="p">,</span> <span class="s2">&quot;crema-sparse&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_solve_problem_crema_undirected</span><span class="p">(</span>
                <span class="n">initial_guess</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">adjacency</span><span class="o">=</span><span class="n">adjacency</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                <span class="n">method_adjacency</span><span class="o">=</span><span class="n">method_adjacency</span><span class="p">,</span>
                <span class="n">initial_guess_adjacency</span><span class="o">=</span><span class="n">initial_guess_adjacency</span><span class="p">,</span>
                <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
                <span class="n">full_return</span><span class="o">=</span><span class="n">full_return</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="n">linsearch</span><span class="o">=</span><span class="n">linsearch</span><span class="p">,</span>
                <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
                <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_error</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">min eig = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">))</span></div>

<div class="viewcode-block" id="UndirectedGraph.ensemble_sampler"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.UndirectedGraph.ensemble_sampler">[docs]</a>    <span class="k">def</span> <span class="nf">ensemble_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">cpu_n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;sample/&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The function sample a given number of graphs in the ensemble</span>
<span class="sd">        generated from the last model solved. Each grpah is an edgelist</span>
<span class="sd">        written in the output directory as `.txt` file.</span>
<span class="sd">        The function is parallelised and can run on multiple cpus.</span>

<span class="sd">        :param n: Number of graphs to sample.</span>
<span class="sd">        :type n: int</span>
<span class="sd">        :param cpu_n: Number of cpus to use, defaults to 1.</span>
<span class="sd">        :type cpu_n: int, optional</span>
<span class="sd">        :param output_dir: Name of the output directory, defaults to &quot;sample/&quot;.</span>
<span class="sd">        :type output_dir: str, optional</span>
<span class="sd">        :param seed: Random seed, defaults to 42.</span>
<span class="sd">        :type seed: int, optional</span>
<span class="sd">        :raises ValueError: [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># al momento funziona solo sull&#39;ultimo problema risolto</span>

        <span class="c1"># create the output directory</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

        <span class="c1"># compute the sample</span>

        <span class="c1"># seed specification</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">,</span> <span class="s2">&quot;cm_exp&quot;</span><span class="p">]:</span>
            <span class="n">iter_files</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span>
                <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_files</span><span class="p">:</span>
                <span class="n">eg</span><span class="o">.</span><span class="n">ensemble_sampler_cm_graph</span><span class="p">(</span>
                    <span class="n">outfile_name</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">cpu_n</span><span class="o">=</span><span class="n">cpu_n</span><span class="p">,</span>
                    <span class="n">seed</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ecm&quot;</span><span class="p">,</span> <span class="s2">&quot;ecm_exp&quot;</span><span class="p">]:</span>
            <span class="n">iter_files</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span>
                <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_files</span><span class="p">:</span>
                <span class="n">eg</span><span class="o">.</span><span class="n">ensemble_sampler_ecm_graph</span><span class="p">(</span>
                    <span class="n">outfile_name</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">cpu_n</span><span class="o">=</span><span class="n">cpu_n</span><span class="p">,</span>
                    <span class="n">seed</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span><span class="p">:</span>
                <span class="c1"># deterministic adj matrix</span>
                <span class="n">iter_files</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span>
                    <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_files</span><span class="p">:</span>
                    <span class="n">eg</span><span class="o">.</span><span class="n">ensemble_sampler_crema_ecm_det_graph</span><span class="p">(</span>
                        <span class="n">outfile_name</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                        <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span>
                        <span class="n">adj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span><span class="p">,</span>
                        <span class="n">cpu_n</span><span class="o">=</span><span class="n">cpu_n</span><span class="p">,</span>
                        <span class="n">seed</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># probabilistic adj matrix</span>
                <span class="n">iter_files</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span>
                    <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_files</span><span class="p">:</span>
                    <span class="n">eg</span><span class="o">.</span><span class="n">ensemble_sampler_crema_ecm_prob_graph</span><span class="p">(</span>
                        <span class="n">outfile_name</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                        <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span>
                        <span class="n">adj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span><span class="p">,</span>
                        <span class="n">cpu_n</span><span class="o">=</span><span class="n">cpu_n</span><span class="p">,</span>
                        <span class="n">seed</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema-sparse&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span><span class="p">:</span>
                <span class="c1"># probabilistic adj matrix</span>
                <span class="n">iter_files</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span>
                    <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_files</span><span class="p">:</span>
                    <span class="n">eg</span><span class="o">.</span><span class="n">ensemble_sampler_crema_sparse_ecm_prob_graph</span><span class="p">(</span>
                        <span class="n">outfile_name</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                        <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">beta</span><span class="p">,</span>
                        <span class="n">adj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span><span class="p">,</span>
                        <span class="n">cpu_n</span><span class="o">=</span><span class="n">cpu_n</span><span class="p">,</span>
                        <span class="n">seed</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;insert a model&quot;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="DirectedGraph"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.DirectedGraph">[docs]</a><span class="k">class</span> <span class="nc">DirectedGraph</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Directed graph instance can be initialised with</span>
<span class="sd">    adjacency matrix, edgelist, degree sequence or strengths sequence.</span>

<span class="sd">    :param adjacency: Adjacency matrix, defaults to None.</span>
<span class="sd">    :type adjacency: numpy.ndarray, list, scipy.sparse_matrix, optional</span>
<span class="sd">    :param edgelist: edgelist, defaults to None.</span>
<span class="sd">    :type edgelist: numpy.ndarray, list, optional</span>
<span class="sd">    :param degree_sequence: degrees sequence, defaults to None.</span>
<span class="sd">    :type degree_sequence: numpy.ndarray, optional</span>
<span class="sd">    :param strength_sequence: strengths sequence, defaults to None.</span>
<span class="sd">    :type strength_sequence: numpy.ndarray, optional</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">adjacency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">edgelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">degree_sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">strength_sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgelist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_sout</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_sin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_randomized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_weighted</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_graph</span><span class="p">(</span>
            <span class="n">adjacency</span><span class="o">=</span><span class="n">adjacency</span><span class="p">,</span>
            <span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span>
            <span class="n">degree_sequence</span><span class="o">=</span><span class="n">degree_sequence</span><span class="p">,</span>
            <span class="n">strength_sequence</span><span class="o">=</span><span class="n">strength_sequence</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avg_mat</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Reduced problem parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_reduced</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq_out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_n_out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_n_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq_out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_dim</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_multiplicity</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Problem solutions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># reduced solutions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Problem (reduced) residuals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residuals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">final_result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_beta</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># non-zero indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_degree</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_strength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_strength</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># functen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_initialize_graph</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">adjacency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">edgelist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">degree_sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">strength_sequence</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="k">if</span> <span class="n">adjacency</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">adjacency</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
            <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">isspmatrix</span><span class="p">(</span><span class="n">adjacency</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;The adjacency matrix must be passed as a list or numpy&quot;</span>
                     <span class="s2">&quot; array or scipy sparse matrix.&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">adjacency</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adjacency</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;The adjacency matrix entries must be positive.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">adjacency</span><span class="p">,</span> <span class="nb">list</span>
                <span class="p">):</span>
                    <span class="c1"># Cast it to a numpy array: if it is given as a list</span>
                    <span class="c1"># it should not be too large</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span> <span class="o">=</span> <span class="n">adjacency</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span> <span class="o">=</span> <span class="n">adjacency</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">adjacency</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">in_degree</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">out_degree</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">in_strength</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">out_strength</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">float64</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_sout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_weighted</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">edgelist</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edgelist</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;The edgelist must be passed as a list or numpy array.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgelist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgelist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="p">(</span><span class="s2">&quot;This is not an edgelist. An edgelist must be a list&quot;</span>
                         <span class="s2">&quot; or array of couples of nodes with optional weights.&quot;</span>
                         <span class="s2">&quot; Is this an adjacency matrix?&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">edgelist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">edgelist</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">edgelist_from_edgelist_directed</span><span class="p">(</span><span class="n">edgelist</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">edgelist</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">nodes_dict</span><span class="p">,</span>
                    <span class="p">)</span> <span class="o">=</span> <span class="n">nef</span><span class="o">.</span><span class="n">edgelist_from_edgelist_directed</span><span class="p">(</span><span class="n">edgelist</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">degree_sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;The degree sequence must be passed as a list&quot;</span>
                     <span class="s2">&quot; or numpy array.&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>  <span class="c1"># TODO: bare exception</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;The degree sequence must contain numeric values.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A degree cannot be negative.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;Strength-in/out arrays must have same length.&quot;</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">degree_sequence</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span> <span class="o">=</span> <span class="n">degree_sequence</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span> <span class="o">=</span> <span class="n">degree_sequence</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">strength_sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                            <span class="p">(</span><span class="s2">&quot;The strength sequence must be passed as a&quot;</span>
                             <span class="s2">&quot; list or numpy array.&quot;</span><span class="p">)</span>
                        <span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">):</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="nb">int</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                        <span class="k">except</span><span class="p">:</span>  <span class="c1"># TODO: bare exception to check</span>
                            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                                <span class="p">(</span><span class="s2">&quot;The strength sequence must contain&quot;</span>
                                 <span class="s2">&quot; numeric values.&quot;</span><span class="p">)</span>
                            <span class="p">)</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A strength cannot be negative.&quot;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                                    <span class="p">(</span><span class="s2">&quot;Strength-in/out arrays must have&quot;</span>
                                     <span class="s2">&quot; same length.&quot;</span><span class="p">)</span>
                                <span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">=</span> <span class="n">strength_sequence</span><span class="p">[</span>
                                <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span>
                            <span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">=</span> <span class="n">strength_sequence</span><span class="p">[</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:</span>
                            <span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_sout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">)[</span>
                                <span class="mi">0</span>
                            <span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">is_weighted</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="n">strength_sequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;The strength sequence must be passed as a list or&quot;</span>
                     <span class="s2">&quot; numpy array.&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">except</span><span class="p">:</span>  <span class="c1"># TODO: bare exception</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;The strength sequence must contain numeric values.&quot;</span>
                    <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;A strength cannot be negative.&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                            <span class="s2">&quot;Strength-in/out arrays must have same length.&quot;</span>
                        <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strength_sequence</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">=</span> <span class="n">strength_sequence</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">=</span> <span class="n">strength_sequence</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_sout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_weighted</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="DirectedGraph.set_adjacency_matrix"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.DirectedGraph.set_adjacency_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">set_adjacency_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">adjacency</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes a graph from the adjacency matrix.</span>

<span class="sd">        :param adjacency: Adjacency matrix.</span>
<span class="sd">        :type adjacency: numpy.ndarray, list, scipy.sparse_matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;Graph already contains edges or has a degree sequence.&quot;</span>
                 <span class="s2">&quot; Use clean_edges() first.&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_graph</span><span class="p">(</span><span class="n">adjacency</span><span class="o">=</span><span class="n">adjacency</span><span class="p">)</span></div>

<div class="viewcode-block" id="DirectedGraph.set_edgelist"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.DirectedGraph.set_edgelist">[docs]</a>    <span class="k">def</span> <span class="nf">set_edgelist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edgelist</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes a graph from the edgelist.</span>

<span class="sd">        :param adjacency: Edgelist</span>
<span class="sd">        :type adjacency: numpy.ndarray, list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;Graph already contains edges or has a degree sequence.&quot;</span>
                 <span class="s2">&quot; Use clean_edges() first.&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_graph</span><span class="p">(</span><span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">)</span></div>

<div class="viewcode-block" id="DirectedGraph.set_degree_sequences"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.DirectedGraph.set_degree_sequences">[docs]</a>    <span class="k">def</span> <span class="nf">set_degree_sequences</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">degree_sequence</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes graph from the degrees sequence.</span>

<span class="sd">        :param adjacency: Degrees sequence</span>
<span class="sd">        :type adjacency: numpy.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;Graph already contains edges or has a degree sequence.&quot;</span>
                 <span class="s2">&quot; Use clean_edges() first.&quot;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_graph</span><span class="p">(</span><span class="n">degree_sequence</span><span class="o">=</span><span class="n">degree_sequence</span><span class="p">)</span></div>

<div class="viewcode-block" id="DirectedGraph.clean_edges"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.DirectedGraph.clean_edges">[docs]</a>    <span class="k">def</span> <span class="nf">clean_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes all initialized graph attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adjacency</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edgelist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deg_seq</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_initialized</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">_solve_problem</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_guess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># TODO:aggiungere un default a initial guess</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;dcm&quot;</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;quasinewton&quot;</span><span class="p">,</span>
        <span class="n">max_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">full_return</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">linsearch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">regularise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">regularise_eps</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span> <span class="o">=</span> <span class="n">full_return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">=</span> <span class="n">initial_guess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regularise</span> <span class="o">=</span> <span class="n">regularise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_problem</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span>

        <span class="n">sol</span> <span class="o">=</span> <span class="n">sof</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span>
            <span class="n">x0</span><span class="p">,</span>
            <span class="n">fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span>
            <span class="n">fun_jac</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun_jac</span><span class="p">,</span>
            <span class="n">step_fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step_fun</span><span class="p">,</span>
            <span class="n">linsearch_fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun_linsearch</span><span class="p">,</span>
            <span class="n">hessian_regulariser</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hessian_regulariser</span><span class="p">,</span>
            <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
            <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">regularise</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">regularise</span><span class="p">,</span>
            <span class="n">regularise_eps</span><span class="o">=</span><span class="n">regularise_eps</span><span class="p">,</span>
            <span class="n">full_return</span><span class="o">=</span><span class="n">full_return</span><span class="p">,</span>
            <span class="n">linsearch</span><span class="o">=</span><span class="n">linsearch</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_solved_problem_dcm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comput_time</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_steps</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alfa_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">solution</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_out</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_out</span><span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_set_solved_problem_dcm_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span><span class="p">:</span>
            <span class="c1"># conversion from theta to x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comput_time</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_steps</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alfa_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># conversion from theta to x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">solution</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_out</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_out</span><span class="p">:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_set_solved_problem_decm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comput_time</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_steps</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alfa_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">solution</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_set_solved_problem_decm_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span><span class="p">:</span>
            <span class="c1"># conversion from theta to x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comput_time</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_steps</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alfa_seq</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># conversion from theta to x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">solution</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:</span> <span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_xy</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>

    <span class="k">def</span> <span class="nf">_set_solved_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcm&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem_dcm</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem_dcm_exp</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;decm&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem_decm</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;decm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem_decm_exp</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema&quot;</span><span class="p">,</span> <span class="s2">&quot;crema-sparse&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem_crema_directed</span><span class="p">(</span><span class="n">solution</span><span class="p">)</span>

<div class="viewcode-block" id="DirectedGraph.degree_reduction"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.DirectedGraph.degree_reduction">[docs]</a>    <span class="k">def</span> <span class="nf">degree_reduction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Carries out degree reduction for DBCM.</span>
<span class="sd">        The graph should be initialized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">)))</span>
        <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_index_dseq</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_invert_dseq</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_multiplicity</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dseq</span><span class="p">,</span>
            <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_dseq</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span><span class="o">.</span><span class="n">size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_out</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_in</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">is_reduced</span> <span class="o">=</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">_set_initial_guess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcm&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_guess_dcm</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_guess_dcm_exp</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;decm&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_guess_decm</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;decm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_guess_decm_exp</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema&quot;</span><span class="p">,</span> <span class="s2">&quot;crema-sparse&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_guess_crema_directed</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_set_initial_guess_dcm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The preselected initial guess works best usually.</span>
        <span class="c1"># The suggestion is, if this does not work,</span>
        <span class="c1"># trying with random initial conditions several times.</span>
        <span class="c1"># If you want to customize the initial guess,</span>
        <span class="c1"># remember that the code starts with a reduced number</span>
        <span class="c1"># of rows and columns.</span>
        <span class="c1"># remember if you insert your choice as initial choice,</span>
        <span class="c1"># it should be numpy.ndarray</span>
        <span class="k">if</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">is_reduced</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">degree_reduction</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1"># we reduce the full x0, it&#39;s not very honest</span>
            <span class="c1"># but it&#39;s better to ask to provide an already reduced x0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">r_index_dseq</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:][</span><span class="bp">self</span><span class="o">.</span><span class="n">r_index_dseq</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s1">&#39;degrees_minor&#39;</span><span class="p">:</span>
                <span class="c1"># This +1 increases the stability of the solutions.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_out</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_in</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;uniform&quot;</span><span class="p">:</span>
                <span class="c1"># All probabilities will be 1/2 initially</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_out</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;degrees&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;chung_lu&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> \
                    <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not an available initial guess&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;initial_guess must be str or numpy.ndarray&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_initial_guess_dcm_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The preselected initial guess works best usually.</span>
        <span class="c1"># The suggestion is, if this does not work,</span>
        <span class="c1"># trying with random initial conditions several times.</span>
        <span class="c1"># If you want to customize the initial guess, remember that the code</span>
        <span class="c1"># starts with a reduced number of rows and columns.</span>

        <span class="k">if</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">is_reduced</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">degree_reduction</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="c1"># we reduce the full x0, it&#39;s not very honest</span>
            <span class="c1"># but it&#39;s better to ask to provide an already reduced x0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">r_index_dseq</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:][</span><span class="bp">self</span><span class="o">.</span><span class="n">r_index_dseq</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s1">&#39;degrees_minor&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>  <span class="c1"># This +1 increases the stability of the solutions.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_out</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_in</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;uniform&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_out</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
                <span class="p">)</span>  <span class="c1"># All probabilities will be 1/2 initially</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_n_in</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;degrees&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;chung_lu&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> \
                    <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span> <span class="o">/</span> \
                    <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not an available initial guess&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;initial_guess must be str or numpy.ndarray&#39;</span><span class="p">)</span>

        <span class="n">not_zero_ind_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">[</span><span class="n">not_zero_ind_x</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">[</span><span class="n">not_zero_ind_x</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e3</span>
        <span class="n">not_zero_ind_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span><span class="p">[</span><span class="n">not_zero_ind_y</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r_y</span><span class="p">[</span><span class="n">not_zero_ind_y</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e3</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">r_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r_y</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_initial_guess_crema_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The preselected initial guess works best usually.</span>
        <span class="c1"># The suggestion is, if this does not work,</span>
        <span class="c1"># trying with random initial conditions several times.</span>
        <span class="c1"># If you want to customize the initial guess, remember that</span>
        <span class="c1"># the code starts with a reduced number of rows and columns.</span>
        <span class="c1"># TODO: mettere un self.is_weighted bool</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;strengths&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                    <span class="nb">float</span>
                <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
                    <span class="nb">float</span>
                <span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;strengths_minor&quot;</span><span class="p">:</span>
                <span class="c1"># This +1 increases the stability of the solutions.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not an available initial guess&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;initial_guess must be str or numpy.ndarray&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_initial_guess_decm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The preselected initial guess works best usually.</span>
        <span class="c1"># The suggestion is, if this does not work,</span>
        <span class="c1"># trying with random initial conditions several times.</span>
        <span class="c1"># If you want to customize the initial guess,</span>
        <span class="c1"># remember that the code starts with a reduced number</span>
        <span class="c1"># of rows and columns.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s1">&#39;strengths&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="p">)</span>  <span class="c1"># This +1 increases the stability of the solutions.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;strengths_minor&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">)</span> <span class="o">/</span>\
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;uniform&quot;</span><span class="p">:</span>
                <span class="c1"># All probabilities will be 0.9 initially</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not an available initial guess&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;initial_guess must be str or numpy.ndarray&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_set_initial_guess_decm_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The preselected initial guess works best usually.</span>
        <span class="c1"># The suggestion is, if this does not work,</span>
        <span class="c1">#  trying with random initial conditions several times.</span>
        <span class="c1"># If you want to customize the initial guess, remember that</span>
        <span class="c1"># the code starts with a reduced number of rows and columns.</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;strengths&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_edges</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="p">)</span>  <span class="c1"># This +1 increases the stability of the solutions.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span> <span class="o">/</span>\
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;strengths_minor&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">)</span> <span class="o">/</span>\
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;random&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">==</span> <span class="s2">&quot;uniform&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span>
                <span class="p">)</span>  <span class="c1"># All probabilities will be 1/2 initially</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;</span><span class="si">{}</span><span class="s1"> is not an available initial guess&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;initial_guess must be str or numpy.ndarray&#39;</span><span class="p">)</span>

        <span class="n">not_zero_ind_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">not_zero_ind_x</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">not_zero_ind_x</span><span class="p">])</span>

        <span class="n">not_zero_ind_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">not_zero_ind_y</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">not_zero_ind_y</span><span class="p">])</span>

        <span class="n">not_zero_ind_b_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">[</span><span class="n">not_zero_ind_b_out</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">[</span><span class="n">not_zero_ind_b_out</span><span class="p">])</span>

        <span class="n">not_zero_ind_b_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">!=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">[</span><span class="n">not_zero_ind_b_in</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">[</span><span class="n">not_zero_ind_b_in</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e3</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_solution_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcm_exp&quot;</span><span class="p">,</span> <span class="s2">&quot;dcm&quot;</span><span class="p">,</span> <span class="s2">&quot;crema&quot;</span><span class="p">,</span> <span class="s2">&quot;crema-sparse&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
                <span class="n">ex_k_out</span> <span class="o">=</span> <span class="n">mof</span><span class="o">.</span><span class="n">expected_out_degree_dcm</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
                <span class="n">ex_k_in</span> <span class="o">=</span> <span class="n">mof</span><span class="o">.</span><span class="n">expected_in_degree_dcm</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
                <span class="n">ex_k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">ex_k_out</span><span class="p">,</span> <span class="n">ex_k_in</span><span class="p">))</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">))</span>
                <span class="c1"># print(k, ex_k)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expected_dseq</span> <span class="o">=</span> <span class="n">ex_k</span>
                <span class="c1"># error output</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ex_k</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_degree</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">ex_k</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">)),</span>
                    <span class="nb">ord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
                    <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span><span class="p">:</span>
                    <span class="n">ex_s_out</span> <span class="o">=</span> <span class="n">mof</span><span class="o">.</span><span class="n">expected_out_strength_crema_directed_sparse</span><span class="p">(</span>
                        <span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span>
                    <span class="p">)</span>
                    <span class="n">ex_s_in</span> <span class="o">=</span> <span class="n">mof</span><span class="o">.</span><span class="n">expected_in_stregth_crema_directed_sparse</span><span class="p">(</span>
                        <span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ex_s_out</span> <span class="o">=</span> <span class="n">mof</span><span class="o">.</span><span class="n">expected_out_strength_crema_directed</span><span class="p">(</span>
                        <span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span>
                    <span class="p">)</span>
                    <span class="n">ex_s_in</span> <span class="o">=</span> <span class="n">mof</span><span class="o">.</span><span class="n">expected_in_stregth_crema_directed</span><span class="p">(</span>
                        <span class="n">sol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span>
                    <span class="p">)</span>
                <span class="n">ex_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">ex_s_out</span><span class="p">,</span> <span class="n">ex_s_in</span><span class="p">])</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expected_stregth_seq</span> <span class="o">=</span> <span class="n">ex_s</span>
                <span class="c1"># error output</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error_strength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ex_s</span> <span class="o">-</span> <span class="n">s</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_strength</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span>
                    <span class="nb">abs</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">ex_s</span> <span class="o">-</span> <span class="n">s</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">))</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_strength</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_strength</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span><span class="p">)</span>

        <span class="c1"># potremmo strutturarlo cos per evitare ridondanze</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;decm&quot;</span><span class="p">,</span> <span class="s2">&quot;decm_exp&quot;</span><span class="p">]:</span>
            <span class="n">sol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">))</span>
            <span class="n">ex</span> <span class="o">=</span> <span class="n">mof</span><span class="o">.</span><span class="n">expected_decm</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
            <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expected_dseq</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[:</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">expected_strength_seq</span> <span class="o">=</span> <span class="n">ex</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>

            <span class="c1"># error putput</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_degree</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span>
                    <span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">))</span>
                        <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_dseq</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error_strength</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">))</span>
                    <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_strength_seq</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_strength</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">))</span>
                     <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_strength_seq</span><span class="p">)</span>
                    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">)</span>
                                     <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">))</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relative_error_degree</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span>
                <span class="nb">abs</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">))</span>
                     <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_dseq</span><span class="p">)</span>
                    <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">)</span>
                                     <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">))</span>
                 <span class="p">)</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">ex</span> <span class="o">-</span> <span class="n">k</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema&quot;</span><span class="p">,</span> <span class="s2">&quot;crema-sparse&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_sout</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_sin</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcm&quot;</span><span class="p">,</span> <span class="s2">&quot;dcm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_out</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">rnz_dseq_in</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_out</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nz_index_in</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">r_multiplicity</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;decm&quot;</span><span class="p">,</span> <span class="s2">&quot;decm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">out_strength</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">in_strength</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initialize_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_guess</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_args</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="n">mod_met</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
        <span class="n">mod_met</span> <span class="o">=</span> <span class="n">mod_met</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">model</span><span class="p">,</span> <span class="n">method</span><span class="p">])</span>

        <span class="n">d_fun</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dcm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_dcm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;dcm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_dcm</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;dcm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">iterative_dcm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;dcm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_dcm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;dcm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_dcm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;dcm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">iterative_dcm_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_crema_directed</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_crema_directed</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">iterative_crema_directed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;decm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_decm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;decm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_decm</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;decm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">iterative_decm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;decm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_decm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;decm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_decm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;decm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">iterative_decm_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema-sparse-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_crema_directed_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_prime_crema_directed_sparse</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
                <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">iterative_crema_directed_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="n">d_fun_jac</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dcm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_dcm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;dcm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_dcm</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;dcm-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;dcm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_dcm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;dcm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_dcm_exp</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
                <span class="p">),</span>
            <span class="s2">&quot;dcm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;crema-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_crema_directed</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_crema_directed</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;decm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_decm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;decm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_decm</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;decm-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;decm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_decm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;decm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_decm_exp</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
                <span class="p">),</span>
            <span class="s2">&quot;decm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;crema-sparse-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_crema_directed</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_hessian_diag_crema_directed_sparse</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
                <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-fixed-point&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">d_fun_step</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dcm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_dcm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;dcm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_dcm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;dcm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_dcm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;dcm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_dcm_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;dcm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_dcm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;dcm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_dcm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_directed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_directed</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_directed</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;decm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_decm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;decm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_decm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;decm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_decm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;decm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_decm_exp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;decm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_decm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;decm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_decm_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_directed_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_directed_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
            <span class="s2">&quot;crema-sparse-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_directed_sparse</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args</span>
            <span class="p">),</span>
        <span class="p">}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fun</span> <span class="o">=</span> <span class="n">d_fun</span><span class="p">[</span><span class="n">mod_met</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fun_jac</span> <span class="o">=</span> <span class="n">d_fun_jac</span><span class="p">[</span><span class="n">mod_met</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">step_fun</span> <span class="o">=</span> <span class="n">d_fun_step</span><span class="p">[</span><span class="n">mod_met</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>  <span class="c1"># TODO: remove bare excpets</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Method must be &quot;newton&quot;,&quot;quasinewton&quot;, or &quot;fixed-point&quot;.&#39;</span>
            <span class="p">)</span>

        <span class="c1"># TODO: mancano metodi</span>
        <span class="n">d_pmatrix</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dcm&quot;</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">pmatrix_dcm</span><span class="p">,</span> <span class="s2">&quot;dcm_exp&quot;</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">pmatrix_dcm</span><span class="p">}</span>

        <span class="c1"># Cos basta aggiungere il decm e funziona tutto</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcm&quot;</span><span class="p">,</span> <span class="s2">&quot;dcm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">args_p</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_out</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dseq_in</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fun_pmatrix</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">d_pmatrix</span><span class="p">[</span><span class="n">model</span><span class="p">](</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_p</span><span class="p">)</span>

        <span class="n">args_lin</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dcm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_dcm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_directed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;crema-sparse&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_crema_directed_sparse</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;decm&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_decm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;dcm_exp&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_dcm_exp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
            <span class="s2">&quot;decm_exp&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">mof</span><span class="o">.</span><span class="n">loglikelihood_decm_exp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span> <span class="o">=</span> <span class="n">args_lin</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>

        <span class="n">lins_fun</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dcm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DCM</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;dcm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DCM</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;dcm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DCM_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="s2">&quot;dcm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DCM_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;dcm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DCM_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;dcm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DCM_exp_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="s2">&quot;crema-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_directed</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;crema-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_directed</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;crema-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_directed_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="s2">&quot;crema-sparse-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_directed</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;crema-sparse-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_directed</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;crema-sparse-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_crema_directed_fixed</span><span class="p">(</span>
                <span class="n">x</span><span class="p">),</span>
            <span class="s2">&quot;decm-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DECM</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;decm-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DECM</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;decm-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DECM_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="s2">&quot;decm_exp-newton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DECM_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;decm_exp-quasinewton&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DECM_exp</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">args_lins</span><span class="p">),</span>
            <span class="s2">&quot;decm_exp-fixed-point&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">mof</span><span class="o">.</span><span class="n">linsearch_fun_DECM_exp_fixed</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fun_linsearch</span> <span class="o">=</span> <span class="n">lins_fun</span><span class="p">[</span><span class="n">mod_met</span><span class="p">]</span>

        <span class="n">hess_reg</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dcm&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function_eigen_based</span><span class="p">,</span>
            <span class="s2">&quot;dcm_exp&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function</span><span class="p">,</span>
            <span class="s2">&quot;decm&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function_eigen_based</span><span class="p">,</span>
            <span class="s2">&quot;decm_exp&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function</span><span class="p">,</span>
            <span class="s2">&quot;crema&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function</span><span class="p">,</span>
            <span class="s2">&quot;crema-sparse&quot;</span><span class="p">:</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">hessian_regulariser</span> <span class="o">=</span> <span class="n">hess_reg</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regularise</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularise</span> <span class="o">==</span> <span class="s2">&quot;eigenvalues&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hessian_regulariser</span> <span class="o">=</span> \
                    <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function_eigen_based</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">regularise</span> <span class="o">==</span> <span class="s2">&quot;identity&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hessian_regulariser</span> <span class="o">=</span> <span class="n">sof</span><span class="o">.</span><span class="n">matrix_regulariser_function</span>

    <span class="k">def</span> <span class="nf">_solve_problem_crema_directed</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">initial_guess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="s2">&quot;crema&quot;</span><span class="p">,</span>
        <span class="n">adjacency</span><span class="o">=</span><span class="s2">&quot;dcm&quot;</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;quasinewton&quot;</span><span class="p">,</span>
        <span class="n">method_adjacency</span><span class="o">=</span><span class="s2">&quot;newton&quot;</span><span class="p">,</span>
        <span class="n">initial_guess_adjacency</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
        <span class="n">max_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">full_return</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">linsearch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">regularise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">regularise_eps</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">model</span> <span class="o">==</span> <span class="s2">&quot;crema-sparse&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">isspmatrix</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;adjacency must be a matrix or a method&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_solve_problem</span><span class="p">(</span>
                <span class="n">initial_guess</span><span class="o">=</span><span class="n">initial_guess_adjacency</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">adjacency</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method_adjacency</span><span class="p">,</span>
                <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
                <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
                <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
                <span class="n">full_return</span><span class="o">=</span><span class="n">full_return</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pmatrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fun_pmatrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">]))</span>
                <span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">pmatrix</span><span class="p">)</span>
                <span class="n">raw_ind</span> <span class="o">=</span> <span class="n">raw_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="n">col_ind</span> <span class="o">=</span> <span class="n">col_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="n">weigths_value</span> <span class="o">=</span> <span class="n">pmatrix</span><span class="p">[</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">,</span> <span class="n">weigths_value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">adjacency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span>
            <span class="n">raw_ind</span> <span class="o">=</span> <span class="n">raw_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">col_ind</span> <span class="o">=</span> <span class="n">col_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">weigths_value</span> <span class="o">=</span> <span class="n">adjacency</span><span class="p">[</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">,</span> <span class="n">weigths_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">adjacency</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">adjacency</span> <span class="o">=</span> <span class="n">adjacency</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">adjacency</span><span class="p">)</span>
            <span class="n">raw_ind</span> <span class="o">=</span> <span class="n">raw_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">col_ind</span> <span class="o">=</span> <span class="n">col_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">weigths_value</span> <span class="o">=</span> <span class="n">adjacency</span><span class="p">[</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">,</span> <span class="n">weigths_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">isspmatrix</span><span class="p">(</span><span class="n">adjacency</span><span class="p">):</span>
            <span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">adjacency</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
            <span class="n">raw_ind</span> <span class="o">=</span> <span class="n">raw_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">col_ind</span> <span class="o">=</span> <span class="n">col_ind</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
            <span class="n">weigths_value</span> <span class="o">=</span> <span class="p">(</span><span class="n">adjacency</span><span class="p">[</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">]</span><span class="o">.</span><span class="n">A1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span> <span class="o">=</span> <span class="p">(</span><span class="n">raw_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">,</span> <span class="n">weigths_value</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_sparse</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">=</span> <span class="s2">&quot;crema-sparse&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="o">=</span> <span class="n">model</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">regularise</span> <span class="o">=</span> <span class="n">regularise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span> <span class="o">=</span> <span class="n">full_return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_guess</span> <span class="o">=</span> <span class="n">initial_guess</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_problem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">last_model</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x0</span>

        <span class="n">sol</span> <span class="o">=</span> <span class="n">sof</span><span class="o">.</span><span class="n">solver</span><span class="p">(</span>
            <span class="n">x0</span><span class="p">,</span>
            <span class="n">fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun</span><span class="p">,</span>
            <span class="n">fun_jac</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun_jac</span><span class="p">,</span>
            <span class="n">step_fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">step_fun</span><span class="p">,</span>
            <span class="n">linsearch_fun</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fun_linsearch</span><span class="p">,</span>
            <span class="n">hessian_regulariser</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hessian_regulariser</span><span class="p">,</span>
            <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
            <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">regularise</span><span class="o">=</span><span class="n">regularise</span><span class="p">,</span>
            <span class="n">regularise_eps</span><span class="o">=</span><span class="n">regularise_eps</span><span class="p">,</span>
            <span class="n">linsearch</span><span class="o">=</span><span class="n">linsearch</span><span class="p">,</span>
            <span class="n">full_return</span><span class="o">=</span><span class="n">full_return</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_solved_problem_crema_directed</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_solved_problem_crema_directed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solution</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_return</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comput_time_crema</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_steps_crema</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">norm_seq_crema</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diff_seq_crema</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alfa_seq_crema</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_out</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[:</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span> <span class="o">=</span> <span class="n">solution</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_nodes</span><span class="p">:]</span>

<div class="viewcode-block" id="DirectedGraph.solve_tool"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.DirectedGraph.solve_tool">[docs]</a>    <span class="k">def</span> <span class="nf">solve_tool</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">model</span><span class="p">,</span>
        <span class="n">method</span><span class="p">,</span>
        <span class="n">initial_guess</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">adjacency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">method_adjacency</span><span class="o">=</span><span class="s1">&#39;newton&#39;</span><span class="p">,</span>
        <span class="n">initial_guess_adjacency</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
        <span class="n">max_steps</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">full_return</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">linsearch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">tol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
        <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The function solves the ERGM optimization problem from</span>
<span class="sd">        a range of available models. The user can choose among three</span>
<span class="sd">        optimization methods.</span>
<span class="sd">        The graph should be initialized.</span>

<span class="sd">        :param model: Available models are:</span>
<span class="sd">            - *dcm*: solves DBCM respect to the parameters *x* and &quot;y&quot; of the loglikelihood function, it works for uweighted directed graphs [insert ref].</span>
<span class="sd">            - *dcm-new*: differently from the *dcm* option, *dcm-new* considers the exponents of *x* and *y* as parameters [insert ref].</span>
<span class="sd">            - *decm*: solves DECM respect to the parameters *a_out*, *a_in*, *b_out* and *b_in* of the loglikelihood function, it is conceived for weighted directed graphs [insert ref].</span>
<span class="sd">            - *decm-new*: differently from the *ecm* option, *ecm_exp* considers the exponents of *a_out*, *a_in*, *b_out* and *b_in** as parameters [insert ref].</span>
<span class="sd">            - *crema*: solves CReMa for a weighted directd graphs. In order to compute beta parameters, it requires information about the binary structure of the network. These can be provided by the user by using *adjacency* paramenter.</span>
<span class="sd">            - *crema-sparse*: alternative implementetio of *crema* for large graphs. The *creama-sparse* model doesn&#39;t compute the binary probability matrix avoing memory problems for large graphs.</span>
<span class="sd">        :type model: str</span>
<span class="sd">        :param method: Available methods to solve the given *model* are:</span>
<span class="sd">            - *newton*: uses Newton-Rhapson method to solve the selected model, it can be memory demanding for *crema* because it requires the computation of the entire Hessian matrix. This method is not available for *creama-sparse*.</span>
<span class="sd">            - *quasinewton*: uses Newton-Rhapson method with Hessian matrix approximated by its principal diagonal to find parameters maximising loglikelihood function.</span>
<span class="sd">            - *fixed-point*: uses a fixed-point method to find parameters maximising loglikelihood function.</span>
<span class="sd">        :type method: str</span>
<span class="sd">        :param initial_guess: Starting point solution may affect the results of the optization process. The user can provid an initial guess or choose between the following options:</span>

<span class="sd">            - **Binary Models**:</span>

<span class="sd">                - *random*: random numbers in (0, 1);</span>
<span class="sd">                - *uniform*: uniform initial guess in (0, 1);</span>
<span class="sd">                - *degrees*: initial guess of each node is proportianal to its degree;</span>
<span class="sd">                - *degrees_minor*: initial guess of each node is inversely proportional to its degree;</span>
<span class="sd">                - *chung_lu*: initial guess given by Chung-Lu formula;</span>

<span class="sd">            - **Weighted Models**:</span>

<span class="sd">                - *random*: random numbers in (0, 1);</span>
<span class="sd">                - *uniform*: uniform initial guess in (0, 1);</span>
<span class="sd">                - *strengths*: initial guess of each node is proportianal to its stength;</span>
<span class="sd">                - *strengths_minor*: initial guess of each node is inversely proportional to its strength;</span>

<span class="sd">        :type initial_guess: str, optional</span>
<span class="sd">        :param adjacency: Adjacency can be a binary method (defaults is *dcm-new*) or an adjacency matrix.</span>
<span class="sd">        :type adjacency: str or numpy.ndarray, optional</span>
<span class="sd">        :param method_adjacency: If adjacency is a *model*, it is the *methdod* used to solve it. Defaults to &quot;newton&quot;.</span>
<span class="sd">        :type method_adjacency: str, optional</span>
<span class="sd">        :param initial_guess_adjacency: If adjacency is a *model*, it is the chosen initial guess. Defaults to &quot;random&quot;.</span>
<span class="sd">        :type initial_guess_adjacency: str, optional</span>
<span class="sd">        :param max_steps: maximum number of iteration, defaults to 100.</span>
<span class="sd">        :type max_steps: int, optional</span>
<span class="sd">        :param full_return: If True the algorithm returns more statistics than the obtained solution, defaults to False.</span>
<span class="sd">        :type full_return: bool, optional</span>
<span class="sd">        :param verbose: If True the algorithm prints a bunch of statistics at each step, defaults to False.</span>
<span class="sd">        :type verbose: bool, optional</span>
<span class="sd">        :param linsearch: If True the linsearch function is active, defaults to True.</span>
<span class="sd">        :type linsearch: bool, optional</span>
<span class="sd">        :param tol: parameter controlling the tollerance of the norm the gradient function, defaults to 1e-8.</span>
<span class="sd">        :type tol: float, optional</span>
<span class="sd">        :param eps: parameter controlling the tollerance of the difference between two iterations, defaults to 1e-8.</span>
<span class="sd">        :type eps: float, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: aggiungere tutti i metodi</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcm&quot;</span><span class="p">,</span> <span class="s2">&quot;dcm_exp&quot;</span><span class="p">,</span> <span class="s2">&quot;decm&quot;</span><span class="p">,</span> <span class="s2">&quot;decm_exp&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_solve_problem</span><span class="p">(</span>
                <span class="n">initial_guess</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
                <span class="n">full_return</span><span class="o">=</span><span class="n">full_return</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="n">linsearch</span><span class="o">=</span><span class="n">linsearch</span><span class="p">,</span>
                <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
                <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema&quot;</span><span class="p">,</span> <span class="s1">&#39;crema-sparse&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_solve_problem_crema_directed</span><span class="p">(</span>
                <span class="n">initial_guess</span><span class="o">=</span><span class="n">initial_guess</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                <span class="n">adjacency</span><span class="o">=</span><span class="n">adjacency</span><span class="p">,</span>
                <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span>
                <span class="n">method_adjacency</span> <span class="o">=</span> <span class="n">method_adjacency</span><span class="p">,</span>
                <span class="n">initial_guess_adjacency</span> <span class="o">=</span> <span class="n">initial_guess_adjacency</span><span class="p">,</span>
                <span class="n">max_steps</span><span class="o">=</span><span class="n">max_steps</span><span class="p">,</span>
                <span class="n">full_return</span><span class="o">=</span><span class="n">full_return</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="n">linsearch</span><span class="o">=</span><span class="n">linsearch</span><span class="p">,</span>
                <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span>
                <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_solution_error</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">min eig = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">))</span></div>

<div class="viewcode-block" id="DirectedGraph.ensemble_sampler"><a class="viewcode-back" href="../../NEMtropy.html#NEMtropy.graph_classes.DirectedGraph.ensemble_sampler">[docs]</a>    <span class="k">def</span> <span class="nf">ensemble_sampler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">cpu_n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="s2">&quot;sample/&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The function sample a given number of graphs in the ensemble</span>
<span class="sd">        generated from the last model solved. Each grpah is an edgelist</span>
<span class="sd">        written in the output directory as `.txt` file.</span>
<span class="sd">        The function is parallelised and can run on multiple cpus.</span>

<span class="sd">        :param n: Number of graphs to sample.</span>
<span class="sd">        :type n: int</span>
<span class="sd">        :param cpu_n: Number of cpus to use, defaults to 1.</span>
<span class="sd">        :type cpu_n: int, optional</span>
<span class="sd">        :param output_dir: Name of the output directory, defaults to &quot;sample/&quot;.</span>
<span class="sd">        :type output_dir: str, optional</span>
<span class="sd">        :param seed: Random seed, defaults to 42.</span>
<span class="sd">        :type seed: int, optional</span>
<span class="sd">        :raises ValueError: [description]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># al momento funziona solo sull&#39;ultimo problema risolto</span>
        <span class="c1"># unico input possibile e&#39; la cartella dove salvare i samples</span>
        <span class="c1"># ed il numero di samples</span>

        <span class="c1"># create the output directory</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_dir</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span>

        <span class="c1"># compute the sample</span>

        <span class="c1"># seed specification</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dcm&quot;</span><span class="p">,</span> <span class="s2">&quot;dcm_exp&quot;</span><span class="p">]:</span>
            <span class="n">iter_files</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span>
                <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_files</span><span class="p">:</span>
                <span class="n">eg</span><span class="o">.</span><span class="n">ensemble_sampler_dcm_graph</span><span class="p">(</span>
                    <span class="n">outfile_name</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">cpu_n</span><span class="o">=</span><span class="n">cpu_n</span><span class="p">,</span>
                    <span class="n">seed</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;decm&quot;</span><span class="p">,</span> <span class="s2">&quot;decm_exp&quot;</span><span class="p">]:</span>
            <span class="n">iter_files</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span>
                <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_files</span><span class="p">:</span>
                <span class="n">eg</span><span class="o">.</span><span class="n">ensemble_sampler_decm_graph</span><span class="p">(</span>
                    <span class="n">outfile_name</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                    <span class="n">a_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">a_in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">b_out</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">,</span>
                    <span class="n">b_in</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">,</span>
                    <span class="n">cpu_n</span><span class="o">=</span><span class="n">cpu_n</span><span class="p">,</span>
                    <span class="n">seed</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span><span class="p">:</span>
                <span class="c1"># deterministic adj matrix</span>
                <span class="n">iter_files</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span>
                    <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_files</span><span class="p">:</span>
                    <span class="n">eg</span><span class="o">.</span><span class="n">ensemble_sampler_crema_decm_det_graph</span><span class="p">(</span>
                        <span class="n">outfile_name</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                        <span class="n">beta</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">),</span>
                        <span class="n">adj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span><span class="p">,</span>
                        <span class="n">cpu_n</span><span class="o">=</span><span class="n">cpu_n</span><span class="p">,</span>
                        <span class="n">seed</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># probabilistic adj matrix</span>
                <span class="n">iter_files</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span>
                    <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_files</span><span class="p">:</span>
                    <span class="n">eg</span><span class="o">.</span><span class="n">ensemble_sampler_crema_decm_prob_graph</span><span class="p">(</span>
                        <span class="n">outfile_name</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                        <span class="n">beta</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">),</span>
                        <span class="n">adj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span><span class="p">,</span>
                        <span class="n">cpu_n</span><span class="o">=</span><span class="n">cpu_n</span><span class="p">,</span>
                        <span class="n">seed</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_model</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;crema-sparse&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">adjacency_given</span><span class="p">:</span>
                <span class="c1"># probabilistic adj matrix</span>
                <span class="n">iter_files</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span>
                    <span class="n">output_dir</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.txt&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">iter_files</span><span class="p">:</span>
                    <span class="n">eg</span><span class="o">.</span><span class="n">ensemble_sampler_crema_sparse_decm_prob_graph</span><span class="p">(</span>
                        <span class="n">outfile_name</span><span class="o">=</span><span class="n">item</span><span class="p">,</span>
                        <span class="n">beta</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b_out</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b_in</span><span class="p">),</span>
                        <span class="n">adj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adjacency_crema</span><span class="p">,</span>
                        <span class="n">cpu_n</span><span class="o">=</span><span class="n">cpu_n</span><span class="p">,</span>
                        <span class="n">seed</span><span class="o">=</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;insert a model&quot;</span><span class="p">)</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Emiliano Marchese and Nicolo&#39; Vallarano.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>